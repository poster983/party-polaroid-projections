<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Display</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #imageContainer { position: relative; width: 100%; height: 100vh; }
    .image { position: absolute; top: 0; left: 0; width: 100%; height: 100vh; object-fit: cover; transition: opacity 1s; }
  </style>
</head>
<body>
  <div id="imageContainer"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const imageContainer = document.getElementById('imageContainer');
    let images = [];
    let currentImageIndex = 0;

    async function fetchImages() {
      const response = await fetch('/images');
      images = await response.json();
      displayImages();
    }

    function displayImages() {
      if (images.length === 0) return;

      images.forEach((image, index) => {
        const img = new Image();
        img.src = '/images/file/'+image.uuid;
        img.classList.add('image');
        img.style.opacity = index === 0 ? 1 : 0;
        imageContainer.appendChild(img);
      });

      setInterval(() => {
        const prevImage = imageContainer.children[currentImageIndex];
        currentImageIndex = (currentImageIndex + 1) % images.length;
        const nextImage = imageContainer.children[currentImageIndex];
        prevImage.style.opacity = 0;
        nextImage.style.opacity = 1;
      }, 5000);
    }

    socket.on('newImage', (image) => {
      images.push(image);
      const img = new Image();
      img.src = '/images/file/'+image.uuid;
      img.classList.add('image');
      img.style.opacity = 0;
      imageContainer.appendChild(img);
    });

    fetchImages();
  </script>
</body>
</html>
